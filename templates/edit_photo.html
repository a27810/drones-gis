{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Editar fotograf√≠a ‚Äì Drones GIS" %}{% endblock %}

{% block extra_css %}
<style>
  /* (tus estilos tal cual, sin cambios) */
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }
  .page-title { font-size: 1.4rem; font-weight: 600; }
  .page-subtitle { font-size: 0.9rem; color: #9ca3af; }
  .btn { display:inline-flex; align-items:center; gap:0.35rem; padding:0.4rem 0.85rem;
         border-radius:999px; font-size:0.85rem; border:1px solid transparent;
         text-decoration:none; cursor:pointer; background:#020617; color:#e5e7eb; }
  .btn-primary { background:#10b981; border-color:#10b981; color:#020617; font-weight:500; }
  .btn-secondary { border-color:#374151; }
  .btn-outline { background:transparent; border-color:#4b5563; }
  .btn-danger { background:#b91c1c; border-color:#b91c1c; color:#f9fafb; }
  .btn:hover { filter:brightness(1.05); }

  .layout-grid { display:grid; grid-template-columns:minmax(0, 1.3fr) minmax(0, 1fr); gap:1.3rem; }
  @media (max-width: 900px) { .layout-grid { grid-template-columns:minmax(0, 1fr); } }

  .form-card, .preview-card {
    background:#020617; border-radius:18px; border:1px solid #111827;
    box-shadow:0 10px 25px rgba(0,0,0,0.35); padding:1.2rem 1.4rem;
  }

  .form-group { display:flex; flex-direction:column; gap:0.25rem; font-size:0.85rem; margin-bottom:0.75rem; }
  .form-label { font-size:0.85rem; font-weight:500; }
  .form-help { font-size:0.75rem; color:#9ca3af; }
  .form-control, .form-select, textarea,
  form input, form select, form textarea {
    background:#020617; border-radius:10px; border:1px solid #4b5563;
    color:#e5e7eb; padding:0.45rem 0.6rem; font-size:0.85rem;
  }
  form input[type="file"] { padding:0.35rem 0.6rem; }
  form input:focus, form select:focus, form textarea:focus {
    outline:none; border-color:#10b981; box-shadow:0 0 0 1px rgba(16,185,129,0.4);
  }

  .form-footer { display:flex; justify-content:space-between; gap:0.75rem; margin-top:1.2rem; flex-wrap:wrap; }
  .field-error { color:#f97373; font-size:0.75rem; }
  .preview-card h3 { font-size:0.95rem; margin-bottom:0.7rem; }

  .photo-preview { border-radius:14px; overflow:hidden; border:1px solid #111827; background:#020617; max-height:260px; }
  .photo-preview img { display:block; width:100%; height:auto; object-fit:cover; }

  .preview-meta { margin-top:0.7rem; font-size:0.8rem; color:#9ca3af; display:grid; gap:0.25rem; }
  .preview-meta span { display:inline-flex; align-items:center; gap:0.25rem; }
</style>
{% endblock %}

{% block content %}
<section>
  <div class="page-header">
    <div>
      <h1 class="page-title">
        {% blocktrans %}Editar fotograf√≠a #{{ photo.id }}{% endblocktrans %}
      </h1>
      <p class="page-subtitle">
        {% trans "Ajusta la informaci√≥n, coordenadas o vuelo asociado de la imagen seleccionada." %}
      </p>
    </div>
    <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
      <a href="{% url 'photo_list' %}" class="btn btn-secondary">üì∑ {% trans "Volver a la galer√≠a" %}</a>
      <a href="{% url 'map' %}?photo={{ photo.id }}" class="btn btn-outline">üó∫Ô∏è {% trans "Ver en mapa" %}</a>
    </div>
  </div>

  <div class="layout-grid">
    <!-- Columna izquierda: formulario -->
    <div class="form-card">
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        {% if form.non_field_errors %}
          <div class="field-error" style="margin-bottom:0.8rem;">
            {{ form.non_field_errors }}
          </div>
        {% endif %}

        <div class="form-group">
          <label class="form-label">
            {% trans "Imagen" %}
          </label>
          {{ form.image }}
          <p class="form-help">
            {% trans "Si no eliges un nuevo archivo, se mantendr√° la imagen actual." %}
          </p>
          {% for error in form.image.errors %}
            <p class="field-error">{{ error }}</p>
          {% endfor %}
        </div>

        <div class="form-group">
          <label class="form-label">{% trans "Vuelo asociado" %}</label>
          {{ form.flight }}
          <p class="form-help">
            {% trans "Si asignas un vuelo, la foto aparecer√° vinculada a √©l en el mapa." %}
          </p>
          {% for error in form.flight.errors %}
            <p class="field-error">{{ error }}</p>
          {% endfor %}
        </div>

        <div class="form-group">
          <label class="form-label">{% trans "Notas / descripci√≥n" %}</label>
          {{ form.notes }}
          {% for error in form.notes.errors %}
            <p class="field-error">{{ error }}</p>
          {% endfor %}
        </div>

        <div class="form-group">
          <label class="form-label">{% trans "Latitud" %}</label>
          {{ form.lat }}
          {% for error in form.lat.errors %}
            <p class="field-error">{{ error }}</p>
          {% endfor %}
        </div>

        <div class="form-group">
          <label class="form-label">{% trans "Longitud" %}</label>
          {{ form.lon }}
          {% for error in form.lon.errors %}
            <p class="field-error">{{ error }}</p>
          {% endfor %}
        </div>

        <div class="form-group">
          <label class="form-label">{% trans "Fecha (opcional)" %}</label>
          {{ form.taken_at }}
          {% if form.taken_at.help_text %}
            <p class="form-help">{{ form.taken_at.help_text }}</p>
          {% endif %}
          {% for error in form.taken_at.errors %}
            <p class="field-error">{{ error }}</p>
          {% endfor %}
        </div>

        <div class="form-footer">
          <a href="{% url 'photo_list' %}" class="btn btn-outline">
            {% trans "Cancelar" %}
          </a>
          <button type="submit" class="btn btn-primary">
            üíæ {% trans "Guardar cambios" %}
          </button>
        </div>
      </form>
    </div>

    <!-- Columna derecha: previsualizaci√≥n -->
    <aside class="preview-card">
      <h3>{% trans "Previsualizaci√≥n" %}</h3>

      {% if photo.image %}
        <div class="photo-preview">
          <img src="{{ photo.image.url }}" alt="{% blocktrans %}Foto #{{ photo.id }}{% endblocktrans %}">
        </div>
      {% else %}
        <p class="form-help">
          {% trans "Esta fotograf√≠a no tiene imagen asociada todav√≠a." %}
        </p>
      {% endif %}

      <div class="preview-meta">
        {% if photo.flight %}
          <span>üõ©Ô∏è {% blocktrans %}Vuelo: <strong>{{ photo.flight.name }}</strong>{% endblocktrans %}</span>
        {% endif %}
        {% if photo.lat and photo.lon %}
          <span>üìç {{ photo.lat }}, {{ photo.lon }}</span>
        {% endif %}
        {% if photo.taken_at %}
          <span>üìÖ {{ photo.taken_at }}</span>
        {% endif %}
        {% if photo.notes %}
          <span>üìù {{ photo.notes|truncatechars:120 }}</span>
        {% endif %}
      </div>

      <div style="margin-top:1rem; display:flex; gap:0.5rem; flex-wrap:wrap;">
        <a href="{% url 'map' %}?photo={{ photo.id }}" class="btn btn-outline">
          üó∫Ô∏è {% trans "Centrarse en el mapa" %}
        </a>
        <a href="{% url 'delete_photo' photo.id %}" class="btn btn-danger">
          üóëÔ∏è {% trans "Eliminar foto" %}
        </a>
      </div>
    </aside>
  </div>
</section>
{% endblock %}
