{% extends "base.html" %}

{% block title %}Vuelos registrados ‚Äì Drones GIS{% endblock %}

{% block extra_css %}
<style>
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }

  .page-title {
    font-size: 1.4rem;
    font-weight: 600;
  }

  .page-subtitle {
    font-size: 0.9rem;
    color: #9ca3af;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    padding: 0.4rem 0.8rem;
    border-radius: 999px;
    font-size: 0.85rem;
    border: 1px solid transparent;
    text-decoration: none;
    cursor: pointer;
    background: #020617;
    color: #e5e7eb;
  }

  .btn-primary {
    background: #10b981;
    border-color: #10b981;
    color: #020617;
    font-weight: 500;
  }

  .btn-secondary {
    border-color: #374151;
  }

  .btn-outline {
    background: transparent;
    border-color: #4b5563;
  }

  .btn:hover {
    filter: brightness(1.05);
  }

  .flight-toolbar {
    display: flex;
    flex-wrap: wrap;
    gap: 0.6rem;
    margin-bottom: 1rem;
    align-items: center;
  }

  .flight-toolbar input[type="search"] {
    background: #020617;
    border-radius: 999px;
    border: 1px solid #4b5563;
    color: #e5e7eb;
    font-size: 0.8rem;
    padding: 0.35rem 0.7rem;
    min-width: 220px;
  }

  .flight-list {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
  }

  .flight-card {
    background: #020617;
    border-radius: 18px;
    border: 1px solid #111827;
    box-shadow: 0 10px 25px rgba(0,0,0,0.35);
    padding: 0.85rem 1rem;
    display: grid;
    grid-template-columns: minmax(0, 2fr) minmax(0, 1.4fr) auto;
    gap: 0.8rem;
    align-items: center;
  }

  @media (max-width: 900px) {
    .flight-card {
      grid-template-columns: minmax(0, 1fr);
      align-items: flex-start;
    }
  }

  .flight-main {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .flight-title {
    font-weight: 600;
    font-size: 1rem;
  }

  .flight-title span {
    font-size: 0.75rem;
    color: #9ca3af;
    margin-left: 0.4rem;
  }

  .flight-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 0.3rem 0.8rem;
    font-size: 0.8rem;
    color: #9ca3af;
  }

  .chip {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    border-radius: 999px;
    padding: 0.1rem 0.45rem;
    font-size: 0.7rem;
    border: 1px solid #4b5563;
    color: #9ca3af;
  }

  .flight-notes {
    font-size: 0.78rem;
    color: #9ca3af;
    margin-top: 0.2rem;
  }

  .flight-stats {
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
    font-size: 0.8rem;
    color: #9ca3af;
  }

  .flight-stats-row {
    display: flex;
    justify-content: space-between;
    gap: 0.8rem;
  }

  .flight-actions {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    align-items: flex-end;
  }

  .flight-actions .btn {
    width: max-content;
    justify-content: center;
  }

  .empty-state {
    margin-top: 2.5rem;
    text-align: center;
    color: #9ca3af;
    font-size: 0.9rem;
  }

  .empty-state h3 {
    font-size: 1.1rem;
    margin-bottom: 0.3rem;
  }
</style>
{% endblock %}

{% block content %}
<section>
  <div class="page-header">
    <div>
      <h1 class="page-title">Vuelos registrados</h1>
      <p class="page-subtitle">
        Listado de vuelos con su ruta, modelo de dron y estad√≠sticas b√°sicas.
      </p>
    </div>
    <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
      <a href="{% url 'map' %}" class="btn btn-secondary">üó∫Ô∏è Ver mapa</a>
      <a href="{% url 'flight_create' %}" class="btn btn-primary">‚ûï Nuevo vuelo</a>
    </div>
  </div>

  <!-- Barra sencilla de b√∫squeda (opcional, aunque la vista no filtre a√∫n) -->
  <form method="get" class="flight-toolbar">
    <input type="search"
          name="q"
          value="{{ q }}"
          placeholder="Buscar por nombre o modelo de dron‚Ä¶">
    <button class="btn btn-outline" type="submit">üîç Buscar</button>
  </form>

  {% if q %}
  <p style="font-size:0.8rem; color:#9ca3af; margin:0 0 0.8rem 0;">
    Mostrando resultados para: <strong>{{ q }}</strong>
  </p>
  {% endif %}



  {% if flights %}
    <div class="flight-list">
      {% for flight in flights %}
        <article class="flight-card">
          <!-- Columna principal: info b√°sica -->
          <div class="flight-main">
            <div class="flight-title">
              {{ flight.name }}
              <span>#{{ flight.id }}</span>
            </div>

            <div class="flight-meta">
              {% if flight.date %}
                <span>üìÖ {{ flight.date }}</span>
              {% endif %}
              {% if flight.drone_model %}
                <span>üõ©Ô∏è {{ flight.drone_model }}</span>
              {% endif %}
              {% if flight.location %}
                <span>üìç {{ flight.location }}</span>
              {% endif %}
              {% if flight.path_geojson %}
                <span class="chip">Ruta guardada</span>
              {% else %}
                <span class="chip">Sin ruta</span>
              {% endif %}
            </div>

            {% if flight.notes %}
              <p class="flight-notes">
                {{ flight.notes|truncatechars:140 }}
              </p>
            {% endif %}
          </div>

          <!-- Columna stats -->
          <div class="flight-stats">
            
            <div class="flight-stats-row">
              <span>üìè Distancia estimada</span>
              <span>
                {% if flight.distance_km %}
                  {{ flight.distance_km|floatformat:2 }} km
                {% else %}
                  ‚Äî
                {% endif %}
              </span>
            </div>

            <div class="flight-stats-row">
              <span>üñºÔ∏è N¬∫ de fotos</span>
              <span>
                {% if flight.photo_count %}
                  {{ flight.photo_count }}
                {% else %}
                  0
                {% endif %}
              </span>
            </div>
          </div>

          <!-- Columna acciones -->
          <div class="flight-actions">
            <a href="{% url 'map' %}?flight={{ flight.id }}"
               class="btn btn-outline">
              üó∫Ô∏è Ver en mapa
            </a>

            {% if flight.path_geojson %}
              <a href="{% url 'edit_flight_path' flight.id %}"
                 class="btn btn-secondary">
                ‚úèÔ∏è Editar ruta
              </a>
            {% else %}
              <a href="{% url 'edit_flight_path' flight.id %}"
                 class="btn btn-secondary">
                ‚ûï Dibujar ruta
              </a>
            {% endif %}
          </div>

        </article>
      {% endfor %}
    </div>
  {% else %}
    <div class="empty-state">
      <h3>No hay vuelos registrados</h3>
      <p>Crea tu primer vuelo con <strong>‚ÄúNuevo vuelo‚Äù</strong> para empezar a registrar rutas.</p>
    </div>
  {% endif %}
</section>
{% endblock %}
